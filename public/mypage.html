<!doctype html><html lang="ko"><head>
<meta charset="utf-8" /><title>C-AIR | ë‚˜ì˜ ì˜ˆì•½</title>
<link rel="stylesheet" href="css/styles.css" /></head>
<body>
<nav></nav>
<main class="container">
  <h2>ë‚˜ì˜ ì˜ˆì•½ ì •ë³´</h2>
  <div id="resBox"></div>

  <h2>í•­ê³µí¸ ìƒì„¸ ì •ë³´</h2>
  <div id="flightBox"></div>

  <div style="margin-top:24px">
    <button id="btnChange" class="btn-primary">ì˜ˆì•½ ë³€ê²½</button>
    <button id="btnCancel" class="btn-danger">ì˜ˆì•½ ì·¨ì†Œ</button>
  </div>
</main>
<footer>â“’ 2025 C-AIR.</footer>

<script type="module">
import { renderNav, apiFetch, fmtDateTime, fmtMoney } from "./js/common.js";
renderNav();

const code = new URLSearchParams(location.search).get("code") || "ABC123456789";
let reservation;  // ì „ì—­ì°¸ì¡°

(async ()=>{
  try {
    reservation = await apiFetch(`/api/reservations/${code}`); // â˜…ë°±ì—”ë“œ ë§¤í•‘
    document.getElementById("resBox").innerHTML = `
      <p><strong>ì˜ˆì•½ ë²ˆí˜¸:</strong> ${reservation.code}</p>
      <p><strong>ì˜ˆì•½ ì¼ì‹œ:</strong> ${fmtDateTime(reservation.createdAt)}</p>
      <p><strong>ì˜ˆì•½ì:</strong> ${reservation.customerName} (cno: ${reservation.cno})</p>
      <p><strong>ê²°ì œ ê¸ˆì•¡:</strong> ${fmtMoney(reservation.price)}</p>
      <p><strong>ì˜ˆì•½ ìƒíƒœ:</strong> ${reservation.status}</p>`;
    const f = reservation.flight;
    document.getElementById("flightBox").innerHTML = `
      <p><strong>í•­ê³µí¸ëª…:</strong> ${f.flightNo} (${f.airline})</p>
      <p><strong>ì¶œë°œ:</strong> ${f.from} ${fmtDateTime(f.departureTime)}</p>
      <p><strong>ë„ì°©:</strong> ${f.to} ${fmtDateTime(f.arrivalTime)}</p>
      <p><strong>ì¢Œì„ ë“±ê¸‰:</strong> ${reservation.seatClass}</p>
      <p><strong>ì¢Œì„ ê°€ê²©:</strong> ${fmtMoney(reservation.seatPrice)}</p>`;
  } catch(err) { alert(err.message); }
})();

document.getElementById("btnCancel").onclick = async ()=>{
  if (!confirm("ì •ë§ ì˜ˆì•½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
  try {
    await apiFetch(`/api/reservations/${code}`, { method:"DELETE" }); // â˜…
    alert("ì·¨ì†Œ ì™„ë£Œ");
    location.reload();
  } catch(err) { alert(err.message); }
};

document.getElementById("btnChange").onclick = () =>
  alert("ë³€ê²½ ë¡œì§ì€ ë³„ë„ í˜ì´ì§€ì—ì„œ êµ¬í˜„í•˜ì„¸ìš” ğŸ™‚");
</script>
</body></html>
