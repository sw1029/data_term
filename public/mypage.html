<!doctype html><html lang="ko"><head>
<meta charset="utf-8" /><title>C-AIR | 나의 예약</title>
<link rel="stylesheet" href="css/styles.css" /></head>
<body>
<nav></nav>
<main class="container">
  <h2>나의 예약 정보</h2>
  <div id="resBox"></div>

  <h2>항공편 상세 정보</h2>
  <div id="flightBox"></div>

  <div style="margin-top:24px">
    <button id="btnChange" class="btn-primary">예약 변경</button>
    <button id="btnCancel" class="btn-danger">예약 취소</button>
  </div>
</main>
<footer>ⓒ 2025 C-AIR.</footer>

<script type="module">
import { renderNav, apiFetch, fmtDateTime, fmtMoney } from "./js/common.js";
renderNav();

const code = new URLSearchParams(location.search).get("code") || "ABC123456789";
let reservation;  // 전역참조

(async ()=>{
  try {
    reservation = await apiFetch(`/api/reservations/${code}`); // ★백엔드 매핑
    document.getElementById("resBox").innerHTML = `
      <p><strong>예약 번호:</strong> ${reservation.code}</p>
      <p><strong>예약 일시:</strong> ${fmtDateTime(reservation.createdAt)}</p>
      <p><strong>예약자:</strong> ${reservation.customerName} (cno: ${reservation.cno})</p>
      <p><strong>결제 금액:</strong> ${fmtMoney(reservation.price)}</p>
      <p><strong>예약 상태:</strong> ${reservation.status}</p>`;
    const f = reservation.flight;
    document.getElementById("flightBox").innerHTML = `
      <p><strong>항공편명:</strong> ${f.flightNo} (${f.airline})</p>
      <p><strong>출발:</strong> ${f.from} ${fmtDateTime(f.departureTime)}</p>
      <p><strong>도착:</strong> ${f.to} ${fmtDateTime(f.arrivalTime)}</p>
      <p><strong>좌석 등급:</strong> ${reservation.seatClass}</p>
      <p><strong>좌석 가격:</strong> ${fmtMoney(reservation.seatPrice)}</p>`;
  } catch(err) { alert(err.message); }
})();

document.getElementById("btnCancel").onclick = async ()=>{
  if (!confirm("정말 예약을 취소하시겠습니까?")) return;
  try {
    await apiFetch(`/api/reservations/${code}`, { method:"DELETE" }); // ★
    alert("취소 완료");
    location.reload();
  } catch(err) { alert(err.message); }
};

document.getElementById("btnChange").onclick = () =>
  alert("변경 로직은 별도 페이지에서 구현하세요 🙂");
</script>
</body></html>
