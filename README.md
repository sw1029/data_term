# data_term

# C‑AIR Flight Booking Platform

> ✈️ **C‑AIR** is a full‑stack web application that lets travellers search for flights, reserve seats, and manage itineraries, while giving administrators insight and control over inventory and users.

---

## Table of Contents

1. [Key Features](#key-features)
2. [Tech Stack](#tech-stack)
3. [Project Structure](#project-structure)
4. [Prerequisites](#prerequisites)
5. [Local Setup](#local-setup)
6. [Environment Variables](#environment-variables)
7. [Running the Apps](#running-the-apps)
8. [Database Migrations](#database-migrations)
9. [API Reference](#api-reference)
10. [Front‑end Pages](#front-end-pages)
11. [Testing](#testing)
12. [Security & Best Practices](#security--best-practices)
13. [Contributing](#contributing)
14. [License](#license)

---

## Key Features

| Module               | Capabilities                                                                                    |
| -------------------- | ----------------------------------------------------------------------------------------------- |
| **Flight Search**    | Real‑time search by origin, destination, dates, passenger count; supports one‑way & round‑trip. |
| **Booking Engine**   | Seat availability lookup, fare calculation, booking creation with pending/confirmed states.     |
| **User Accounts**    | JWT‑based auth, profile management, past trips, wish‑lists.                                     |
| **Admin Portal**     | Flight & seat inventory CRUD, price management, booking override, malicious‑user blocking.      |
| **Bulletin Board**   | Simple forum for announcements and user Q\&A (optional toggle).                                 |
| **Product Registry** | Catalogue of ancillaries (meals, lounge passes, etc.) with admin CRUD.                          |
| **API‑First Design** | RESTful JSON APIs consumed by the front‑end; OpenAPI spec provided.                             |

---

## Tech Stack

| Layer     | Technology                                                                                     |
| --------- | ---------------------------------------------------------------------------------------------- |
| Front‑end | **Vanilla HTML / CSS / JS** (no framework) + Fetch API; optional upgrade path to React.        |
| Back‑end  | **Python 3.10**, **FastAPI** (APIRouters), **SQLAlchemy 2** ORM, **python‑jose** auth.  |
| Database  | **Oracle 19c** (on‑prem or ATP).                                                               |
| DevOps    | Pip + virtualenv, gunicorn, nginx (prod), GitHub Actions (CI), pre‑commit hooks (Black, Ruff). |
| Testing   | **pytest**, **pytest‑cov**, **Playwright** (e2e).                                              |

---

## Project Structure

```
c‑air/
├── backend/
│   ├── main.py               # FastAPI application
│   ├── config.py             # Config classes
│   ├── requirements.txt      # Python dependencies
│   ├── extensions/           # JWT, DB, Marshmallow initialisers
│   ├── models/               # SQLAlchemy models (Customer, Airplain, Seats…)
│   ├── schemas/              # marshmallow‑schema <-> model serializers
│   ├── api/                  # Router modules (auth, flights, bookings…)
│   ├── services/             # Business logic (pricing, seat‑map, payments)
│   ├── tasks/                # Async or scheduled jobs (seat expiry)
│   └── migrations/           # Alembic scripts (autogenerated)
├── frontend/
│   ├── assets/
│   │   ├── css/
│   │   │   └── styles.css
│   │   ├── img/
│   │   └── js/
│   │       └── main.js       # Fetch wrapper & DOM helpers
│   └── pages/
│       ├── search.html       # 항공편 검색 (wireframe #1)
│       ├── results.html      # 항공편 목록 & 여정 선택 (wireframe #2)
│       └── booking.html      # 예약 상세 & 결제 (wireframe #3)
└── README.md
```

> **Why separate HTML files?**  Each wireframe is a self‑contained page that calls the API for data; this keeps concerns isolated and enables incremental framework migration later.

---

## Prerequisites

* **Oracle Instant Client 21.11** (or higher) – add to `PATH` / `LD_LIBRARY_PATH`.
* **Python ≥ 3.10** (3.12 validated).
* A running **Oracle DB 19c** instance with the schema in `backend/migrations/versions/0_ddl.sql` applied.
* Node ≥ 18 (only if you plan to bundle assets with esbuild).

---

## Local Setup

```bash
# 1. Clone
$ git clone https://github.com/sw1029/data_term && cd c‑air

# 2. Back‑end
$ python -m venv .venv && source .venv/bin/activate
(.venv) $ pip install -r backend/requirements.txt

# 3. Front‑end (optional bundling)
$ npm i -g esbuild       # or pnpm/yard
$ cd frontend && npm install && cd ..

# 4. Environment
$ cp backend/.env.example backend/.env   # then edit values
```

---

## Environment Variables

| Variable         | Sample                    | Description                               |
| ---------------- | ------------------------- | ----------------------------------------- |
| `APP_ENV`        | `development`             | Application mode.           |
| `ORACLE_DSN`     | `localhost:1521/FREEPDB1` | Full DSN or EZConnect string.             |
| `ORACLE_USER`    | `CAIR_APP`                | App‑owned DB user.                        |
| `ORACLE_PASSWORD`| `secret_pw`               | Password for the above user.              |
| `JWT_SECRET` | `🔑`                      | 256‑bit secret for signing access tokens. |
| `ADMIN_EMAIL`    | `admin@c‑air.io`          | Initial super‑user login.                 |

For more tuneables see `backend/config.py`.

---

## Running the Apps

### Back‑end (FastAPI)

```bash
# activate venv if not already
$ uvicorn app.main:app --reload  # http://127.0.0.1:8000
```

For production:

```bash
$ gunicorn -k uvicorn.workers.UvicornWorker app.main:app -b 0.0.0.0:8000 --workers 4 --timeout 120
```

### Front‑end (Static)

```bash
$ cd frontend
$ python -m http.server 3000   # http://localhost:3000/pages/search.html
```

If you enabled esbuild:

```bash
$ npm run dev                  # live‑reload via esbuild‑serve
```

---

## Database Migrations

| Step                  | Command                                  |
| --------------------- | ---------------------------------------- |
| Generate new revision | `flask db migrate -m "Add loyalty tier"` |
| Apply to DB           | `flask db upgrade`                       |
| Roll back             | `flask db downgrade`                     |

The base DDL aligns with the schema shared in `/docs/db‑schema.md`.

---

## API Reference

The full machine‑readable spec lives in `backend/openapi.yaml`. Highlights:

| Method  | Endpoint                  | Purpose                                                         |
| ------- | ------------------------- | --------------------------------------------------------------- |
| `POST`  | `/api/auth/login`         | Obtain JWT tokens.                                              |
| `GET`   | `/api/flights/search`     | Search flights (`origin`, `dest`, `departDate`, `returnDate?`). |
| `POST`  | `/api/bookings`           | Create booking from selected flight + passengers.               |
| `GET`   | `/api/bookings/{id}`      | Retrieve booking detail.                                        |
| `PATCH` | `/api/admin/flights/{id}` | Update flight metadata (admin only).                            |

> Use `Authorization: Bearer <access‑token>` for protected routes.

---

## Front‑end Pages

| File                 | Wireframe ID | Description                                |
| -------------------- | ------------ | ------------------------------------------ |
| `pages/search.html`  | #1           | Landing & flight search widget.            |
| `pages/results.html` | #2           | Search result list, filters, fare summary. |
| `pages/booking.html` | #3           | Passenger form, seat map, payment choice.  |

Navigation header (`<header class="nav‑bar">`) is imported via a `<template>` to ensure consistency.

---

## Testing

```bash
$ pytest -q                     # unit + integration
$ pytest -m e2e tests/e2e       # Playwright UI tests (headless‑chrome)
$ pytest --cov-report=html      # generate cov report at htmlcov/
```

---

## Security & Best Practices

* Argon2 password hashing (via `argon2‑cffi`).
* Prepared statements & SQLAlchemy ORM to avoid SQL injection.
* CORS w/ allow‑list & CSRF tokens for state‑changing requests.
* Rate limiting (SlowAPI) on login & search endpoints.
* Role‑based access control for admin routes.
* Input validation via marshmallow schemas and WTForms (front‑end).

---

## Contributing

1. Fork the repo and create a feature branch.
2. Follow commit style `feat(scope): message`.
3. Ensure `pre‑commit run --all-files` passes.
4. PRs require at least one approving review & CI green.

---

## License

This project is licensed under the MIT License – see [`LICENSE`](LICENSE) for details.
