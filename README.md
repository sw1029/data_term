# data_term

# Câ€‘AIR Flight Booking Platform

> âœˆï¸ **Câ€‘AIR** is a fullâ€‘stack web application that lets travellers search for flights, reserve seats, and manage itineraries, while giving administrators insight and control over inventory and users.

---

## Table of Contents

1. [Key Features](#key-features)
2. [TechÂ Stack](#tech-stack)
3. [Project Structure](#project-structure)
4. [Prerequisites](#prerequisites)
5. [LocalÂ Setup](#local-setup)
6. [EnvironmentÂ Variables](#environment-variables)
7. [RunningÂ theÂ Apps](#running-the-apps)
8. [DatabaseÂ Migrations](#database-migrations)
9. [APIÂ Reference](#api-reference)
10. [Frontâ€‘endÂ Pages](#front-end-pages)
11. [Testing](#testing)
12. [SecurityÂ &Â BestÂ Practices](#security--best-practices)
13. [Contributing](#contributing)
14. [License](#license)

---

## KeyÂ Features

| Module               | Capabilities                                                                                    |
| -------------------- | ----------------------------------------------------------------------------------------------- |
| **Flight Search**    | Realâ€‘time search by origin, destination, dates, passenger count; supports oneâ€‘way & roundâ€‘trip. |
| **Booking Engine**   | Seat availability lookup, fare calculation, booking creation with pending/confirmed states.     |
| **User Accounts**    | JWTâ€‘based auth, profile management, past trips, wishâ€‘lists.                                     |
| **Admin Portal**     | Flight & seat inventory CRUD, price management, booking override, maliciousâ€‘user blocking.      |
| **Bulletin Board**   | Simple forum for announcements and user Q\&A (optional toggle).                                 |
| **Product Registry** | Catalogue of ancillaries (meals, lounge passes, etc.) with admin CRUD.                          |
| **APIâ€‘First Design** | RESTful JSON APIs consumed by the frontâ€‘end; OpenAPI spec provided.                             |

---

## TechÂ Stack

| Layer     | Technology                                                                                     |
| --------- | ---------------------------------------------------------------------------------------------- |
| Frontâ€‘end | **Vanilla HTMLâ€¯/â€¯CSSâ€¯/â€¯JS** (no framework) + Fetch API; optional upgrade path to React.        |
| Backâ€‘end  | **PythonÂ 3.10**, **FastAPI** (APIRouters), **SQLAlchemyÂ 2** ORM, **pythonâ€‘jose** auth.  |
| Database  | **OracleÂ 19c** (onâ€‘prem or ATP).                                                               |
| DevOps    | PipÂ +Â virtualenv, gunicorn, nginx (prod), GitHub Actions (CI), preâ€‘commit hooks (Black, Ruff). |
| Testing   | **pytest**, **pytestâ€‘cov**, **Playwright** (e2e).                                              |

---

## ProjectÂ Structure

```
câ€‘air/
â”œâ”€â”€ backend/
â”‚Â Â  â”œâ”€â”€ main.py               # FastAPI application
â”‚Â Â  â”œâ”€â”€ config.py             # Config classes
â”‚Â Â  â”œâ”€â”€ requirements.txt      # Python dependencies
â”‚Â Â  â”œâ”€â”€ extensions/           # JWT, DB, Marshmallow initialisers
â”‚Â Â  â”œâ”€â”€ models/               # SQLAlchemy models (Customer, Airplain, Seatsâ€¦)
â”‚Â Â  â”œâ”€â”€ schemas/              # marshmallowâ€‘schema <-> model serializers
â”‚Â Â  â”œâ”€â”€ api/                  # Router modules (auth, flights, bookingsâ€¦)
â”‚Â Â  â”œâ”€â”€ services/             # Business logic (pricing, seatâ€‘map, payments)
â”‚Â Â  â”œâ”€â”€ tasks/                # Async or scheduled jobs (seat expiry)
â”‚Â Â  â””â”€â”€ migrations/           # Alembic scripts (autogenerated)
â”œâ”€â”€ frontend/
â”‚Â Â  â”œâ”€â”€ assets/
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ css/
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ styles.css
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ img/
â”‚Â Â  â”‚Â Â  â””â”€â”€ js/
â”‚Â Â  â”‚Â Â      â””â”€â”€ main.js       # Fetch wrapper & DOM helpers
â”‚Â Â  â””â”€â”€ pages/
â”‚Â Â      â”œâ”€â”€ search.html       # í•­ê³µí¸ ê²€ìƒ‰ (wireframeÂ #1)
â”‚Â Â      â”œâ”€â”€ results.html      # í•­ê³µí¸ ëª©ë¡Â & ì—¬ì • ì„ íƒ (wireframeÂ #2)
â”‚Â Â      â””â”€â”€ booking.html      # ì˜ˆì•½ ìƒì„¸Â & ê²°ì œ (wireframeÂ #3)
â””â”€â”€ README.md
```

> **Why separate HTML files?**  Each wireframe is a selfâ€‘contained page that calls the API for data; this keeps concerns isolated and enables incremental framework migration later.

---

## Prerequisites

* **OracleÂ InstantÂ ClientÂ 21.11** (or higher) â€“ add to `PATH` / `LD_LIBRARY_PATH`.
* **PythonÂ â‰¥Â 3.10** (3.12 validated).
* A running **OracleÂ DBÂ 19c** instance with the schema in `backend/migrations/versions/0_ddl.sql` applied.
* NodeÂ â‰¥Â 18 (only if you plan to bundle assets with esbuild).

---

## LocalÂ Setup

```bash
# 1. Clone
$ git clone https://github.com/sw1029/data_term && cd câ€‘air

# 2. Backâ€‘end
$ python -m venv .venv && source .venv/bin/activate
(.venv) $ pip install -r backend/requirements.txt

# 3. Frontâ€‘end (optional bundling)
$ npm i -g esbuild       # or pnpm/yard
$ cd frontend && npm install && cd ..

# 4. Environment
$ cp backend/.env.example backend/.env   # then edit values
```

---

## EnvironmentÂ Variables

| Variable         | Sample                    | Description                               |
| ---------------- | ------------------------- | ----------------------------------------- |
| `APP_ENV`        | `development`             | Application mode.           |
| `ORACLE_DSN`     | `localhost:1521/FREEPDB1` | Full DSN or EZConnect string.             |
| `ORACLE_USER`    | `CAIR_APP`                | Appâ€‘owned DB user.                        |
| `ORACLE_PASSWORD`| `secret_pw`               | Password for the above user.              |
| `JWT_SECRET` | `ğŸ”‘`                      | 256â€‘bit secret for signing access tokens. |
| `ADMIN_EMAIL`    | `admin@câ€‘air.io`          | Initial superâ€‘user login.                 |

For more tuneables see `backend/config.py`.

---

## RunningÂ theÂ Apps

### Backâ€‘end (FastAPI)

```bash
# activate venv if not already
$ uvicorn app.main:app --reload  # http://127.0.0.1:8000
```

For production:

```bash
$ gunicorn -k uvicorn.workers.UvicornWorker app.main:app -b 0.0.0.0:8000 --workers 4 --timeout 120
```

### Frontâ€‘end (Static)

```bash
$ cd frontend
$ python -m http.server 3000   # http://localhost:3000/pages/search.html
```

If you enabled esbuild:

```bash
$ npm run dev                  # liveâ€‘reload via esbuildâ€‘serve
```

---

## DatabaseÂ Migrations

| Step                  | Command                                  |
| --------------------- | ---------------------------------------- |
| Generate new revision | `flask db migrate -m "Add loyalty tier"` |
| Apply to DB           | `flask db upgrade`                       |
| Roll back             | `flask db downgrade`                     |

The base DDL aligns with the schema shared in `/docs/dbâ€‘schema.md`.

---

## APIÂ Reference

The full machineâ€‘readable spec lives in `backend/openapi.yaml`. Highlights:

| Method  | Endpoint                  | Purpose                                                         |
| ------- | ------------------------- | --------------------------------------------------------------- |
| `POST`  | `/api/auth/login`         | Obtain JWT tokens.                                              |
| `GET`   | `/api/flights/search`     | Search flights (`origin`, `dest`, `departDate`, `returnDate?`). |
| `POST`  | `/api/bookings`           | Create booking from selected flight + passengers.               |
| `GET`   | `/api/bookings/{id}`      | Retrieve booking detail.                                        |
| `PATCH` | `/api/admin/flights/{id}` | Update flight metadata (admin only).                            |

> Use `Authorization: Bearer <accessâ€‘token>` for protected routes.

---

## Frontâ€‘endÂ Pages

| File                 | Wireframe ID | Description                                |
| -------------------- | ------------ | ------------------------------------------ |
| `pages/search.html`  | #1           | Landing & flight search widget.            |
| `pages/results.html` | #2           | Search result list, filters, fare summary. |
| `pages/booking.html` | #3           | Passenger form, seat map, payment choice.  |

Navigation header (`<header class="navâ€‘bar">`) is imported via a `<template>` to ensure consistency.

---

## Testing

```bash
$ pytest -q                     # unit + integration
$ pytest -m e2e tests/e2e       # Playwright UI tests (headlessâ€‘chrome)
$ pytest --cov-report=html      # generate cov report at htmlcov/
```

---

## SecurityÂ &Â BestÂ Practices

* Argon2 password hashing (via `argon2â€‘cffi`).
* Prepared statements & SQLAlchemy ORM to avoid SQL injection.
* CORS w/ allowâ€‘list & CSRF tokens for stateâ€‘changing requests.
* Rate limiting (SlowAPI) on login & search endpoints.
* Roleâ€‘based access control for admin routes.
* Input validation via marshmallow schemas and WTForms (frontâ€‘end).

---

## Contributing

1. Fork the repo and create a feature branch.
2. Follow commit style `feat(scope): message`.
3. Ensure `preâ€‘commit run --all-files` passes.
4. PRs require at least one approving review & CI green.

---

## License

This project is licensed under the MIT License â€“ see [`LICENSE`](LICENSE) for details.
